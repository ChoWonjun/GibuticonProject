<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="message">
	<insert id="sendMessage" parameterType="messageVO">
		insert into gibu_message(no, sender_id, receiver_id, subject, context, send_time)
		values(gibu_message_seq.nextval, #{sender.id}, #{receiverId}, #{title},#{content},sysdate)
	</insert>
	
	<delete id="delMessage">
		delete from gibu_message where no=#{value}
	</delete>
	
	<resultMap type="messageVO" id="messageRM">
		<result property="sender.id" column="sender_id" />
		<result property="sender.name" column="name" />
		<result property="receiverId" column="receiver_id" />
		<result property="sendTime" column="send_time" />
		<result property="readTime" column="read_time" />
   </resultMap>
	
	<select id="getMessageByNo" resultMap="messageRM">
		select m.no, m.sender_id, m.receiver_id, mem.name, m.subject, m.context, m.send_time, m.read_time 
		from gibu_message m, member mem
		where m.sender_id=mem.id and no=#{value}
	</select>
	
	<update id="readMessage">
		update gibu_message set read_time=sysdate where no=#{value}
	</update>
</mapper>